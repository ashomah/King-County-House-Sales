---
title: "King County House Sales"
author: "Ashley O'Mahony | [ashleyomahony.com](http://ashleyomahony.com) | May 2019"
always_allow_html: yes
output:
  html_document:
    theme: yeti
  github_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r Load Libraries, echo = FALSE, include = FALSE}

source('scripts/install_packages.R')

if (is.null(webshot:::find_phantom())){
  webshot::install_phantomjs()
  }
```

``` {r Load Prepared Data, echo = FALSE}
load('data_output/RMarkdown_Objects.RData')
```


***

## King County House Sales Dataset  

The *King County House Sales* dataset contains the **house sales in King County (USA), between May 2014 and May 2015**. The original dataset can be found on [Kaggle](https://www.kaggle.com/harlfoxem/housesalesprediction).  

All the files of this project are saved in a [GitHub repository](https://github.com/ashomah/King-County-House-Sales).  

The dataset consists in:  

* a Train Set with 17,277 observations with 19 house features, the ID, and the price,  
* a Test Set with 4,320 observations with 19 house features and the ID.  

This map shows where the properties listed in the dataset are located:  

```{r Map, echo=FALSE, fig.height=8, fig.width=10, fig.align='center', warning=FALSE}

load('data_output/hp_map_9.rda')

ggmap(hp_map_9) +
  labs(x = '', y = '') +
  theme(legend.position = 'none') +
  geom_point(data = long_lat,
             aes(x = long, y = lat, colour = 'red'),
             size = 0.5)

```

This project aims to predict the house price based on its features.  

</br>

***

## Packages  

This analysis requires these R packages:

* Data Cleaning: `tidyr`  
    
* Plotting: `ggplot2`, `corrplot`, `GGally`, `gridExtra`  
    
* Statistics: `caret`  

These packages are installed and loaded if necessary by the main script.

</br>

***

## Data Preparation  

The dataset is pretty clean, with no missing value in both Train and Test sets. A quick look at the `id` values also shows that only a few houses have been sold more than once on the period, so it doesn't seem relevant the consider the `id` and the `date` for this analysis. We will thus focus on the house features only to predict its price.  

``` {r NAs and id, echo = FALSE}

# Check if contains NAs ----
na_count <-
  sapply(hp_train, function(y)
    sum(length(which(is.na(
      y
    )))))
na_count <- data.frame(na_count)
na_count$perc <- round(na_count$na_count / nrow(hp_train) * 100, 2)
print(paste0(nrow(na_count[na_count$na_count != 0, ]), ' columns of the Train Set have NAs.'))

na_count <-
  sapply(hp_test, function(y)
    sum(length(which(is.na(
      y
    )))))
na_count <- data.frame(na_count)
na_count$perc <- round(na_count$na_count / nrow(hp_test) * 100, 2)
print(paste0(nrow(na_count[na_count$na_count != 0, ]), ' columns of the Test Set have NAs.'))


# Check if house IDs are relevant ----
print(
  paste0(
    houses_sold_multi_times_train,
    ' houses sold more than once on the period, for a total of ',
    houses_train,
    ' houses in the Train Set (',
    round(houses_sold_multi_times_train / houses_train, 3),
    '%).'
  )
)

print(
  paste0(
    houses_sold_multi_times_test,
    ' houses in the Test Set sold more than once on the period, for a total of ',
    houses_test,
    ' houses in the Test Set (',
    round(houses_sold_multi_times_test / houses_test, 3),
    '%).'
  )
)

```






